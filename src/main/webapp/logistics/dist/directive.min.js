app.directive("autoTitle",function(){return{restrict:"A",link:function(e,c,r){!function e(){var t=c.text();if(-1==t.indexOf("{{")){t=(t=(t=t.replace(/[ \t]{2,}/g," ")).replace(/[ \n]{2,}/g,"\n")).replace(/[ \r\n]{2,}/g,"\r\n");var n=0;try{n=parseInt(r.autoTitle)}catch(e){}for(var i=1;n&&n<t.length&&0<n;)t=t.substring(0,n)+"\n"+t.substring(n),n*=++i;r.title&&(t=r.title+t),c[0].title=t}else setTimeout(function(){e()},500)}()}}}),app.directive("uniqueVerify",["$http",function(c){return{restrict:"A",require:"ngModel",scope:{uniqueVerify:"@"},link:function(t,e,n,i){i.$parsers.unshift(function(e){return c({method:"GET",url:t.uniqueVerify,params:{parameter:e}}).success(function(e){var t=!1;-1==e&&(t=!0),i.$setValidity("uniqueVerify",t)}).error(function(e){i.$setValidity("uniqueVerify",!1)}),e})}}}]),app.directive("equals",function(){return{require:"ngModel",link:function(n,e,i,c){function t(e){var t=e===n.$eval(i.equals);return c.$setValidity("equal",t),t?e:void 0}c.$parsers.push(t),c.$formatters.push(t),n.$watch(i.equals,function(){c.$setViewValue(c.$viewValue)})}}}),app.directive("select2",["select2Query",function(l){return{restrict:"A",scope:{config:"=",ngModel:"=",select2Model:"="},link:function(e,t,n){var i=t[0].tagName,c={allowClear:!0,multiple:!!n.multiple,placeholder:n.placeholder||""};if("SELECT"===i){var r=$(t);return delete c.multiple,angular.extend(c,e.config),r.prepend('<option value=""></option>').val("").select2(c),e.$watch("ngModel",function(e){setTimeout(function(){r.find('[value^="?"]').remove(),r.select2("val",e)},0)},!0),!1}"INPUT"===i&&(r=$(t),n.query&&(e.config=l[n.query]()),e.$watch("config",function(){angular.extend(c,e.config),r.select2("destroy").select2(c)},!0),r.on("change",function(){e.$apply(function(){e.select2Model=r.select2("data")})}),e.$watch("select2Model",function(e){r.select2("data",e)},!0),e.$watch("ngModel",function(e){if(c.ajax||c.multiple)return!1;r.select2("val",e)},!0))}}}]),app.factory("select2Query",["$timeout",function(e){return{testAJAX:function(){return{minimumInputLength:1,ajax:{url:"http://api.rottentomatoes.com/api/public/v1.0/movies.json",dataType:"jsonp",data:function(e){return{q:e,page_limit:10,apikey:"ju6z9mjyajq2djue3gbvv26t"}},results:function(e,t){return{results:e.movies}}},formatResult:function(e){return e.title},formatSelection:function(e){return e.title}}}}}]),app.controller("appCtrl",["$scope","$timeout",function(e,t){e.config1={data:[],placeholder:"尚无数据"},t(function(){e.config1.data=[{id:1,text:"bug"},{id:2,text:"duplicate"},{id:3,text:"invalid"},{id:4,text:"wontfix"}],e.config1.placeholder="加载完毕"},1e3),e.config2=[{id:6,text:"来自ng-repeat"},{id:7,text:"来自ng-repeat"},{id:8,text:"来自ng-repeat"}],e.config3={data:[{id:1,text:"bug"},{id:2,text:"duplicate"},{id:3,text:"invalid"},{id:4,text:"wontfix"}]}}]),app.directive("treeView",function(){return{restrict:"E",templateUrl:"js/directive/tree/treeView.html",scope:{treeData:"=",canChecked:"=",textField:"@",itemClicked:"&",itemCheckedChanged:"&",itemTemplateUrl:"@"},controller:["$scope",function(i){i.itemExpended=function(e,t){e.$$isExpend=!e.$$isExpend,t.stopPropagation()},i.getItemIcon=function(e){return i.isLeaf(e)?"":e.$$isExpend?"glyphicon glyphicon-minus":"glyphicon glyphicon-plus"},i.isLeaf=function(e){return!e.childItems||!e.childItems.length},i.warpCallback=function(e,t,n){(i[e]||angular.noop)({$item:t,$event:n})}}]}}),app.directive("treeViewLeaf",function(){return{restrict:"E",templateUrl:"js/directive/tree/treeView.html",scope:{treeData:"=",canChecked:"=",textField:"@",itemClicked:"&",itemCheckedChanged:"&",itemTemplateUrl:"@"},controller:["$scope",function(i){i.itemExpended=function(e,t){e.$$isExpend=!e.$$isExpend,t.stopPropagation()},i.getItemIcon=function(e){return i.isLeaf(e)?"":e.$$isExpend?"glyphicon glyphicon-minus":"glyphicon glyphicon-plus"},i.isLeaf=function(e){return!e.childItems||!e.childItems.length},i.warpCallback=function(e,t,n){i.linkageCheckbox(t.childItems,t.checked),(i[e]||angular.noop)({$item:t,$event:n})},i.linkageCheckbox=function(e,t){if(null!=e&&null!=e)for(var n=0;n<e.length;n++)e[n].checked=t,i.linkageCheckbox(e[n].childItems,t)}}]}}),app.directive("onlyTreeView",function(){return{restrict:"E",templateUrl:"js/directive/tree/onlyTreeView.html",scope:{treeData:"=",canChecked:"=",textField:"@",itemClicked:"&",itemCheckedChanged:"&",itemTemplateUrl:"@"},controller:["$scope",function(i){i.itemExpended=function(e,t){e.$$isExpend=!e.$$isExpend,t.stopPropagation()},i.getItemIcon=function(e){return i.isLeaf(e)?"":e.$$isExpend?"glyphicon glyphicon-minus":"glyphicon glyphicon-plus"},i.isLeaf=function(e){return!e.childItems||!e.childItems.length},i.warpCallback=function(e,t,n){(i[e]||angular.noop)({$item:t,$event:n})}}]}});